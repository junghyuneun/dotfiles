'use babel';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.activate = void 0;
Object.defineProperty(exports, "config", {
  enumerable: true,
  get: function () {
    return _config.default;
  }
});
exports.write = exports.getStatusColors = exports.deactivate = void 0;
var _path = require("path");
var _postcssHexrgba = _interopRequireDefault(require("postcss-hexrgba"));
var _postcssMixins = _interopRequireDefault(require("postcss-mixins"));
var _mixins = _interopRequireDefault(require("./mixins"));
var _postcssNested = _interopRequireDefault(require("postcss-nested"));
var _postcss = _interopRequireDefault(require("postcss"));
var _config = _interopRequireDefault(require("./config"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const {
  CompositeDisposable
} = require('atom'); // eslint-disable-line
const disposables = new CompositeDisposable();

/**
 * Retrieves the current theme status colors from a dummy less file setup
 * by this plugin. Colors are needed for Muted setting along with the Git
 * status colors.
 *
 * @returns {string[]} 4 color values from current UI theme, hex or rgba. If the
 * stylesheet isn't found for some reason, an empty array is returned.
 */
const getStatusColors = () => {
  const styles = atom.styles.styleElementsBySourcePath;
  const style = Object.keys(styles).filter(path => /\/flexicons\/.+\/variables\.less$/.test(path)).map(key => styles[key].innerHTML).pop();
  return style ? style.split('\n').filter(line => /\-\-/.test(line)).map(line => line.split(':').slice(1).pop().slice(1, -1)) : [];
};

/**
 * This is the meat of the plugin. It takes the input CSS file, along with the
 * plugin settings defined in Atom, and runs them through PostCSS. It leverages
 * a few PostCSS plugins and outputs to a less file that is loaded up to apply
 * the icon styles.
 *
 * @param {File} inputFile - An Atom File class that contains the mixins for
 * all of the icons.
 *
 * @param {File} outputFile - An Atom File class where the resulting CSS from
 * PostCSS is written to.
 *
 * @param {Function} [callbackFn] - An optional callback function to be called
 * if the transform completes successfully.
 */
exports.getStatusColors = getStatusColors;
const write = (inputFile, outputFile, callbackFn) => () => (0, _postcss.default)([(0, _postcssMixins.default)((0, _mixins.default)(getStatusColors())), (0, _postcssNested.default)(), (0, _postcssHexrgba.default)()]).process(inputFile.readSync(), {
  from: inputFile.path
}).then(result => {
  if (outputFile.readSync() === result.css) {
    throw new Error('Result CSS matches output file.');
  }
  outputFile.writeSync(result.css);
}).catch(() => {}).then(() => callbackFn && callbackFn());
exports.write = write;
/**
 * Used by Atom for when the plugin is enabled or Atom is starting/reloading.
 * This function will setup instances of the input/output files. Defines the
 * function to reload the package when settings change. Sets up listeners for
 * when settings change and the initial load of Atom is complete.
 */
const activate = () => {
  const {
    File
  } = require('atom'); // eslint-disable-line
  const styles = (0, _path.join)(__dirname, '..', 'styles');
  const inputFile = new File((0, _path.join)(__dirname, 'css', 'index.css'));
  const outputFile = new File((0, _path.join)(styles, 'flexicons.css'));
  const reload = () => atom.packages.getLoadedPackage('flexicons').reloadStylesheets();
  const writeAndReload = () => write(inputFile, outputFile, reload);
  disposables.add(atom.config.onDidChange('flexicons', writeAndReload()));

  // Always generate file on package activation.
  writeAndReload()();
};

/**
 * Used by Atom for when the plugin is disabled or Atom is being closed. This
 * will properly dispose of the listener functions setup in the `activate`
 * method.
 */
exports.activate = activate;
const deactivate = () => disposables.dispose();
exports.deactivate = deactivate;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDb21wb3NpdGVEaXNwb3NhYmxlIiwicmVxdWlyZSIsImRpc3Bvc2FibGVzIiwiZ2V0U3RhdHVzQ29sb3JzIiwic3R5bGVzIiwiYXRvbSIsInN0eWxlRWxlbWVudHNCeVNvdXJjZVBhdGgiLCJzdHlsZSIsIk9iamVjdCIsImtleXMiLCJmaWx0ZXIiLCJwYXRoIiwidGVzdCIsIm1hcCIsImtleSIsImlubmVySFRNTCIsInBvcCIsInNwbGl0IiwibGluZSIsInNsaWNlIiwid3JpdGUiLCJpbnB1dEZpbGUiLCJvdXRwdXRGaWxlIiwiY2FsbGJhY2tGbiIsInBvc3Rjc3MiLCJtaXhpbnMiLCJtaXhpbnNDb25maWciLCJuZXN0ZWQiLCJoZXhyZ2JhIiwicHJvY2VzcyIsInJlYWRTeW5jIiwiZnJvbSIsInRoZW4iLCJyZXN1bHQiLCJjc3MiLCJFcnJvciIsIndyaXRlU3luYyIsImNhdGNoIiwiYWN0aXZhdGUiLCJGaWxlIiwiam9pbiIsIl9fZGlybmFtZSIsInJlbG9hZCIsInBhY2thZ2VzIiwiZ2V0TG9hZGVkUGFja2FnZSIsInJlbG9hZFN0eWxlc2hlZXRzIiwid3JpdGVBbmRSZWxvYWQiLCJhZGQiLCJjb25maWciLCJvbkRpZENoYW5nZSIsImRlYWN0aXZhdGUiLCJkaXNwb3NlIl0sInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCdcblxuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnXG5pbXBvcnQgaGV4cmdiYSBmcm9tICdwb3N0Y3NzLWhleHJnYmEnXG5pbXBvcnQgbWl4aW5zIGZyb20gJ3Bvc3Rjc3MtbWl4aW5zJ1xuaW1wb3J0IG1peGluc0NvbmZpZyBmcm9tICcuL21peGlucydcbmltcG9ydCBuZXN0ZWQgZnJvbSAncG9zdGNzcy1uZXN0ZWQnXG5pbXBvcnQgcG9zdGNzcyBmcm9tICdwb3N0Y3NzJ1xuXG5jb25zdCB7IENvbXBvc2l0ZURpc3Bvc2FibGUgfSA9IHJlcXVpcmUoJ2F0b20nKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5jb25zdCBkaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlXG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHRoZW1lIHN0YXR1cyBjb2xvcnMgZnJvbSBhIGR1bW15IGxlc3MgZmlsZSBzZXR1cFxuICogYnkgdGhpcyBwbHVnaW4uIENvbG9ycyBhcmUgbmVlZGVkIGZvciBNdXRlZCBzZXR0aW5nIGFsb25nIHdpdGggdGhlIEdpdFxuICogc3RhdHVzIGNvbG9ycy5cbiAqXG4gKiBAcmV0dXJucyB7c3RyaW5nW119IDQgY29sb3IgdmFsdWVzIGZyb20gY3VycmVudCBVSSB0aGVtZSwgaGV4IG9yIHJnYmEuIElmIHRoZVxuICogc3R5bGVzaGVldCBpc24ndCBmb3VuZCBmb3Igc29tZSByZWFzb24sIGFuIGVtcHR5IGFycmF5IGlzIHJldHVybmVkLlxuICovXG5leHBvcnQgY29uc3QgZ2V0U3RhdHVzQ29sb3JzID0gKCkgPT4ge1xuICBjb25zdCBzdHlsZXMgPSBhdG9tLnN0eWxlcy5zdHlsZUVsZW1lbnRzQnlTb3VyY2VQYXRoXG4gIGNvbnN0IHN0eWxlID0gT2JqZWN0LmtleXMoc3R5bGVzKVxuICAgIC5maWx0ZXIocGF0aCA9PiAvXFwvZmxleGljb25zXFwvLitcXC92YXJpYWJsZXNcXC5sZXNzJC8udGVzdChwYXRoKSlcbiAgICAubWFwKGtleSA9PiBzdHlsZXNba2V5XS5pbm5lckhUTUwpXG4gICAgLnBvcCgpXG5cbiAgcmV0dXJuIHN0eWxlID9cbiAgICBzdHlsZVxuICAgICAgLnNwbGl0KCdcXG4nKVxuICAgICAgLmZpbHRlcihsaW5lID0+IC9cXC1cXC0vLnRlc3QobGluZSkpXG4gICAgICAubWFwKGxpbmUgPT5cbiAgICAgICAgbGluZVxuICAgICAgICAgIC5zcGxpdCgnOicpXG4gICAgICAgICAgLnNsaWNlKDEpXG4gICAgICAgICAgLnBvcCgpXG4gICAgICAgICAgLnNsaWNlKDEsIC0xKVxuICAgICAgKSA6XG4gICAgW11cbn1cblxuLyoqXG4gKiBUaGlzIGlzIHRoZSBtZWF0IG9mIHRoZSBwbHVnaW4uIEl0IHRha2VzIHRoZSBpbnB1dCBDU1MgZmlsZSwgYWxvbmcgd2l0aCB0aGVcbiAqIHBsdWdpbiBzZXR0aW5ncyBkZWZpbmVkIGluIEF0b20sIGFuZCBydW5zIHRoZW0gdGhyb3VnaCBQb3N0Q1NTLiBJdCBsZXZlcmFnZXNcbiAqIGEgZmV3IFBvc3RDU1MgcGx1Z2lucyBhbmQgb3V0cHV0cyB0byBhIGxlc3MgZmlsZSB0aGF0IGlzIGxvYWRlZCB1cCB0byBhcHBseVxuICogdGhlIGljb24gc3R5bGVzLlxuICpcbiAqIEBwYXJhbSB7RmlsZX0gaW5wdXRGaWxlIC0gQW4gQXRvbSBGaWxlIGNsYXNzIHRoYXQgY29udGFpbnMgdGhlIG1peGlucyBmb3JcbiAqIGFsbCBvZiB0aGUgaWNvbnMuXG4gKlxuICogQHBhcmFtIHtGaWxlfSBvdXRwdXRGaWxlIC0gQW4gQXRvbSBGaWxlIGNsYXNzIHdoZXJlIHRoZSByZXN1bHRpbmcgQ1NTIGZyb21cbiAqIFBvc3RDU1MgaXMgd3JpdHRlbiB0by5cbiAqXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tGbl0gLSBBbiBvcHRpb25hbCBjYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWRcbiAqIGlmIHRoZSB0cmFuc2Zvcm0gY29tcGxldGVzIHN1Y2Nlc3NmdWxseS5cbiAqL1xuZXhwb3J0IGNvbnN0IHdyaXRlID0gKCBpbnB1dEZpbGUsIG91dHB1dEZpbGUsIGNhbGxiYWNrRm4gKSA9PiAoKSA9PlxuICBwb3N0Y3NzKFtcbiAgICBtaXhpbnMobWl4aW5zQ29uZmlnKGdldFN0YXR1c0NvbG9ycygpKSksXG4gICAgbmVzdGVkKCksXG4gICAgaGV4cmdiYSgpLFxuICBdKVxuICAgIC5wcm9jZXNzKGlucHV0RmlsZS5yZWFkU3luYygpLCB7IGZyb206IGlucHV0RmlsZS5wYXRoIH0pXG4gICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgIGlmICggb3V0cHV0RmlsZS5yZWFkU3luYygpID09PSByZXN1bHQuY3NzICkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3VsdCBDU1MgbWF0Y2hlcyBvdXRwdXQgZmlsZS4nKVxuICAgICAgfVxuXG4gICAgICBvdXRwdXRGaWxlLndyaXRlU3luYyhyZXN1bHQuY3NzKVxuICAgIH0pXG4gICAgLmNhdGNoKCgpID0+IHt9KVxuICAgIC50aGVuKCgpID0+IGNhbGxiYWNrRm4gJiYgY2FsbGJhY2tGbigpKVxuXG5leHBvcnQgeyBkZWZhdWx0IGFzIGNvbmZpZyB9IGZyb20gJy4vY29uZmlnJ1xuXG4vKipcbiAqIFVzZWQgYnkgQXRvbSBmb3Igd2hlbiB0aGUgcGx1Z2luIGlzIGVuYWJsZWQgb3IgQXRvbSBpcyBzdGFydGluZy9yZWxvYWRpbmcuXG4gKiBUaGlzIGZ1bmN0aW9uIHdpbGwgc2V0dXAgaW5zdGFuY2VzIG9mIHRoZSBpbnB1dC9vdXRwdXQgZmlsZXMuIERlZmluZXMgdGhlXG4gKiBmdW5jdGlvbiB0byByZWxvYWQgdGhlIHBhY2thZ2Ugd2hlbiBzZXR0aW5ncyBjaGFuZ2UuIFNldHMgdXAgbGlzdGVuZXJzIGZvclxuICogd2hlbiBzZXR0aW5ncyBjaGFuZ2UgYW5kIHRoZSBpbml0aWFsIGxvYWQgb2YgQXRvbSBpcyBjb21wbGV0ZS5cbiAqL1xuZXhwb3J0IGNvbnN0IGFjdGl2YXRlID0gKCkgPT4ge1xuICBjb25zdCB7IEZpbGUgfSA9IHJlcXVpcmUoJ2F0b20nKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIGNvbnN0IHN0eWxlcyA9IGpvaW4oX19kaXJuYW1lLCAnLi4nLCAnc3R5bGVzJylcbiAgY29uc3QgaW5wdXRGaWxlID0gbmV3IEZpbGUoam9pbihfX2Rpcm5hbWUsICdjc3MnLCAnaW5kZXguY3NzJykpXG4gIGNvbnN0IG91dHB1dEZpbGUgPSBuZXcgRmlsZShqb2luKHN0eWxlcywgJ2ZsZXhpY29ucy5jc3MnKSlcbiAgY29uc3QgcmVsb2FkID0gKCkgPT5cbiAgICBhdG9tLnBhY2thZ2VzLmdldExvYWRlZFBhY2thZ2UoJ2ZsZXhpY29ucycpLnJlbG9hZFN0eWxlc2hlZXRzKClcbiAgY29uc3Qgd3JpdGVBbmRSZWxvYWQgPSAoKSA9PiB3cml0ZShpbnB1dEZpbGUsIG91dHB1dEZpbGUsIHJlbG9hZClcblxuICBkaXNwb3NhYmxlcy5hZGQoXG4gICAgYXRvbS5jb25maWcub25EaWRDaGFuZ2UoJ2ZsZXhpY29ucycsIHdyaXRlQW5kUmVsb2FkKCkpXG4gIClcblxuICAvLyBBbHdheXMgZ2VuZXJhdGUgZmlsZSBvbiBwYWNrYWdlIGFjdGl2YXRpb24uXG4gIHdyaXRlQW5kUmVsb2FkKCkoKVxufVxuXG4vKipcbiAqIFVzZWQgYnkgQXRvbSBmb3Igd2hlbiB0aGUgcGx1Z2luIGlzIGRpc2FibGVkIG9yIEF0b20gaXMgYmVpbmcgY2xvc2VkLiBUaGlzXG4gKiB3aWxsIHByb3Blcmx5IGRpc3Bvc2Ugb2YgdGhlIGxpc3RlbmVyIGZ1bmN0aW9ucyBzZXR1cCBpbiB0aGUgYGFjdGl2YXRlYFxuICogbWV0aG9kLlxuICovXG5leHBvcnQgY29uc3QgZGVhY3RpdmF0ZSA9ICgpID0+IGRpc3Bvc2FibGVzLmRpc3Bvc2UoKVxuIl0sIm1hcHBpbmdzIjoiQUFBQSxXQUFXOztBQUFBO0VBQUE7QUFBQTtBQUFBO0FBQUE7RUFBQTtFQUFBO0lBQUE7RUFBQTtBQUFBO0FBQUE7QUFFWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFrRUE7QUFBNEM7QUFoRTVDLE1BQU07RUFBRUE7QUFBb0IsQ0FBQyxHQUFHQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUM7QUFDaEQsTUFBTUMsV0FBVyxHQUFHLElBQUlGLG1CQUFtQjs7QUFFM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLE1BQU1HLGVBQWUsR0FBRyxNQUFNO0VBQ25DLE1BQU1DLE1BQU0sR0FBR0MsSUFBSSxDQUFDRCxNQUFNLENBQUNFLHlCQUF5QjtFQUNwRCxNQUFNQyxLQUFLLEdBQUdDLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDTCxNQUFNLENBQUMsQ0FDOUJNLE1BQU0s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